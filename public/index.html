<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- ... existing code ... -->

    <!-- Add (or adjust) CSP to allow GA/Ads/Cloudflare; remove if your server sends a CSP header -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://pagead2.googlesyndication.com https://static.cloudflareinsights.com;
      connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com;
      img-src 'self' data: https://www.google-analytics.com https://pagead2.googlesyndication.com https://www.googletagmanager.com;
      style-src 'self' 'unsafe-inline';
      frame-src https://*.doubleclick.net https://*.googlesyndication.com;
    ">

    <!-- REMOVE any existing analytics tags -->

    <!-- Google tag (gtag.js) -->
    <!-- Replace the static script tag with a defensive loader -->
    <script>
      (function () {
        // Only attempt to load analytics in production over http/https
        var isProd = location.hostname !== 'localhost' && /^https?:/.test(location.protocol);
        if (!isProd) {
          return;
        }

        // Dynamically load gtag.js
        var s = document.createElement('script');
        s.async = true;
        s.src = 'https://www.googletagmanager.com/gtag/js?id=G-XT4KKGQQJ2';
        s.crossOrigin = 'anonymous';
        s.onerror = function () {
          console.warn('gtag.js failed to load (network/CSP/ad-block).');
        };
        document.head.appendChild(s);

        // Initialize gtag (inline init requires script-src to allow 'unsafe-inline' in CSP)
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        window.gtag = gtag;

        gtag('js', new Date());
        gtag('config', 'G-XT4KKGQQJ2', { debug_mode: true });

        gtag('event', 'TraeAI_test', {
          source: 'index.html',
          page_location: window.location.href
        });
      })();
    </script>

    <!-- If you include Cloudflare Insights, use their recommended snippet (remove integrity; add crossorigin) -->
    <!--
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
            data-cf-beacon='{"token":"YOUR_TOKEN"}'
            crossorigin="anonymous"></script>
    -->

    <!-- If you include AdSense, ensure CSP allows pagead2.googlesyndication.com and consider crossorigin -->
    <!--
    <script async crossorigin="anonymous"
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2842777009443084"></script>
    -->

    <!-- ... existing code ... -->
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!-- ... existing code ... -->
  </body>
</html>